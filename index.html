<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>Port Example</title>
  <script src="elm.js"></script>
  <style type="text/css">
    label {
      display: block;
      margin-top: 5px;
    }
    button {
      margin: 5px;
    }
  </style>
</head>

<body>
  <div id="elm"></div>

  <script>
    let flags = ''
    let node = document.getElementById('elm');
    var app = Elm.Main.init({node: node, flags: flags});
    app.ports.sendPortMsg.subscribe(function(msg){
      let method = msg.method;
      switch (method) {
        case 'setLocalStorageItem':
          localStorage.setItem(msg.payload.key, msg.payload.value);
          break;
        case 'getLocalStorageItem':
          let value = localStorage.getItem(msg.payload) || 'null';
          app.ports.gotPortMsg.send({method: 'gotLocalStorageItem', payload: {key: msg.payload, value: value}});
          break;
        case 'removeLocalStorageItem':
          localStorage.removeItem(msg.payload);
          break;
        case 'clearLocalStorage':
          localStorage.clear();
          break;
        case 'getCookies':
          let cookies = document.cookie;
          app.ports.gotPortMsg.send({method: 'gotCookies', payload: {cookies: cookies}});
          break;
        case 'setCookie':
          let cookie = `${msg.payload.key}=${msg.payload.value}`;
          document.cookie=cookie;
          break;
        case 'connectToServer':
          app.ports.gotPortMsg.send({method: 'connectedToServer', payload: null});
      }
    })
  </script>
</body>
</html>
